# Surge 5 iOS 回国场景（海外访问中国大陆服务）配置
# 使用说明：
# 1) 在 [Proxy] 填入你可用的“中国大陆出口”节点（CN_*），可任选 trojan/vmess/ss 等协议。
# 2) 默认仅将中国大陆相关服务走 CN 代理，其余流量保持 DIRECT（可按需在 [Proxy Group]/[Rule] 中调整）。
# 3) 本配置引用 BlackMatrix7 远程规则，保持自动更新。
# 4) iOS 导入：将本文件放入 iCloud Drive 或通过本地/HTTP 导入至 Surge 5。

[General]
loglevel = notify
ipv6 = true
skip-proxy = 127.0.0.1, localhost, *.local, *.lan, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
internet-test-url = http://www.gstatic.com/generate_204
proxy-test-url = http://www.gstatic.com/generate_204
auto-set-system-proxy = true
allow-wifi-access = false
# 如需在同局域网下访问 Surge 面板可打开并设置密码（注意安全）
# http-api = 0.0.0.0:6171
# http-api-access-token = your_strong_token_here

[DNS]
enable = true
ipv6 = true
enhanced-mode = fake-ip
fake-ip-range = 198.18.0.1/16
fake-ip-filter = *.lan, *.local, *.localhost, localhost, ntp.*.*, time.*.*, *.time.edu.cn, *.ntp.org, *.255.255.255
prefer-doh = true
doh-server = https://dns.alidns.com/dns-query, https://doh.pub/dns-query, https://1.1.1.1/dns-query, https://dns.google/dns-query
default-nameserver = 223.5.5.5, 180.76.76.76, 119.29.29.29, 114.114.114.114
# 按需开启：将国内域名优先通过本地/国内 DNS 解析
# policy-nameserver = CN: 223.5.5.5, 180.76.76.76

[Proxy]
# 在下方填入你的“回国节点”（中国大陆出口）。以下为占位示例，替换为你自己的服务器与凭据。
# trojan 示例
CN_Trojan = trojan, cn.example.com, 443, password=REPLACE_WITH_YOUR_PASSWORD, sni=cn.example.com, skip-cert-verify=true, udp-relay=true
# vmess 示例（ws+tls）
CN_VMess = vmess, cn2.example.com, 443, username=REPLACE_WITH_UUID, tls=true, sni=vmess.example.com, skip-cert-verify=true, ws=true, ws-path=/, ws-headers=Host:vmess.example.com, udp-relay=true
# shadowsocks 示例
CN_SS = ss, cn3.example.com, 8388, encrypt-method=aes-128-gcm, password=REPLACE_WITH_PASSWORD, udp-relay=true

# 如希望非中国流量也通过代理，可在此添加你的“国际出口”代理并加入 Global 组
# GLOBAL_SOCKS = socks5, global.example.com, 1080, username=user, password=pass

[Proxy Group]
# 回国主组：优先自动选择 CN 节点，可手动切换或直连
CN = select, CN_AUTO, CN_Trojan, CN_VMess, CN_SS, DIRECT
CN_AUTO = url-test, CN_Trojan, CN_VMess, CN_SS, url=http://www.gstatic.com/generate_204, interval=300, tolerance=150

# 全局流量策略：默认 DIRECT（可改为走代理）
Global = select, DIRECT, CN, CN_AUTO
# 如果添加了 GLOBAL_SOCKS 之类的国际代理，可这样启用：
# Global = select, DIRECT, GLOBAL_AUTO, CN, CN_AUTO
# GLOBAL_AUTO = url-test, GLOBAL_SOCKS, url=http://www.gstatic.com/generate_204, interval=300, tolerance=150

# 最终默认策略（供 MATCH 使用）
Default = select, DIRECT, CN, CN_AUTO, Global

[Rule]
# 本地网络直连优先
IP-CIDR, 127.0.0.0/8, DIRECT, no-resolve
IP-CIDR, 10.0.0.0/8, DIRECT, no-resolve
IP-CIDR, 172.16.0.0/12, DIRECT, no-resolve
IP-CIDR, 192.168.0.0/16, DIRECT, no-resolve
IP-CIDR, 224.0.0.0/4, DIRECT, no-resolve
IP-CIDR6, fe80::/10, DIRECT, no-resolve

# 中国主流影音/常用服务优先走 CN（回国）
RULE-SET, StreamingCN, CN
RULE-SET, WeChat, CN
RULE-SET, Alipay, CN
RULE-SET, Taobao, CN
RULE-SET, JD, CN
RULE-SET, Bilibili, CN
RULE-SET, TencentVideo, CN
RULE-SET, iQIYI, CN
RULE-SET, Youku, CN
RULE-SET, Douyin, CN
RULE-SET, NetEaseMusic, CN
RULE-SET, QQMusic, CN

# 泛中国域名与 IP
RULE-SET, China, CN
RULE-SET, ChinaIP, CN
GEOIP, CN, CN, no-resolve

# 其余走默认策略（默认 DIRECT，可在 [Proxy Group] 调整 Default 组合）
MATCH, Default

[Rule Set]
# BlackMatrix7 - 规则集，保持自动更新
# 中国流媒体（合辑）
StreamingCN = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/StreamingCN/StreamingCN.list, update-interval=86400, opt-parser=true, enabled=true
# 常用中国服务
China = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/China/China.list, update-interval=86400, opt-parser=true, enabled=true
ChinaIP = type=http, behavior=ipcidr, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/ChinaIPs/ChinaIPs.list, update-interval=86400, opt-parser=true, enabled=true

# 分服务精细化（可按需删减）
WeChat = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/WeChat/WeChat.list, update-interval=86400, opt-parser=true, enabled=true
Alipay = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Alipay/Alipay.list, update-interval=86400, opt-parser=true, enabled=true
Taobao = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Taobao/Taobao.list, update-interval=86400, opt-parser=true, enabled=true
JD = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/JD/JD.list, update-interval=86400, opt-parser=true, enabled=true
Bilibili = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Bilibili/Bilibili.list, update-interval=86400, opt-parser=true, enabled=true
TencentVideo = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/TencentVideo/TencentVideo.list, update-interval=86400, opt-parser=true, enabled=true
iQIYI = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/iQIYI/iQIYI.list, update-interval=86400, opt-parser=true, enabled=true
Youku = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Youku/Youku.list, update-interval=86400, opt-parser=true, enabled=true
Douyin = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/Douyin/Douyin.list, update-interval=86400, opt-parser=true, enabled=true
NetEaseMusic = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/NetEaseMusic/NetEaseMusic.list, update-interval=86400, opt-parser=true, enabled=true
QQMusic = type=http, behavior=classical, url=https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Surge/QQMusic/QQMusic.list, update-interval=86400, opt-parser=true, enabled=true

[Host]
# 可按需加入自定义解析
# example.com = 1.2.3.4

[URL Rewrite]
# 回国场景通常无需重写，如需特定服务优化可在此添加

[MITM]
# 回国分流不需要 HTTPS 解密，保持关闭即可
enable = false
